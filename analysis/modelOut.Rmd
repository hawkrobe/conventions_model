---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(tidyverse)
library(ggthemes)
```

Make plot from table in Clark paper

```{r}
data.frame(prediction = c(40.7, 19.1, 13.1, 11.0, 9.2, 8.2, 30.4, 18.1, 13.4, 8.2, 7.8, 6.7),
           t = seq(1,12),
           partner = factor(c(1,1,1,1,1,1,2,2,2,2,2,2))) %>%
  ggplot(aes(x = t, y = prediction, color = partner)) +
    geom_point() +
    geom_line() +
    theme_few() +
    xlab('trial #') +
    ylab("# words") +
    scale_x_continuous(breaks = c(1,3,5,7,9,11)) +
    geom_vline(aes(xintercept = 6.5)) +
    theme(aspect.ratio = 1)

ggsave('../../dissertation/dissertation/figures/modeling/clark92.pdf', height = 8, width = 8, units = 'cm', useDingbats = F)
```

## Simulating models & looking at post-test

```{r}
trajectory <- read_csv('../simulations/cogsci2018/output/trajectorygame1.csv')
ggplot(trajectory, aes(x = time, y = object, fill = val)) +
  geom_tile()
```

```{r}
postTest <- read_csv('../simulations/cogsci2018/output/postTestgame1.csv')
ggplot(postTest, aes(x = word, y = object, fill = val > 2)) +
  geom_tile() +
  facet_wrap(~ agentID)
```

## Fitting human data

```{r}
modelInput <- dir(path = "../simulations/cogsci2018/input/",
    pattern = "game*",
    full.names = T) %>%
  map(read_csv) %>%
  reduce(rbind) %>%
  rename(time = trialNum, gameNum = id)

modelOutput <- dir(path = "../simulations/cogsci2018/output/pragmatics/",
    pattern = "*.csv",
    full.names = T) %>%
  map(read_csv) %>%
  reduce(rbind) %>%
  left_join(modelInput, by = c('gameNum', 'time', 'speakerID', 'listenerID')) %>%
  mutate(sameUtteranceAsParticipant = topSpeakerChoice==trueUtterance,
         sameSelectionAsParticipant = topListenerChoice == trueResponse)
```

Model accuracy appears to track participant accuracy at each point in time... 

```{r}
modelOutput %>%
  gather(src,value,modelCorrect, participantCorrect) %>%
  group_by(time, condition, src) %>%
  summarize(m = mean(value)) %>%
  ggplot(aes(x = time, y = m, color = src)) +
    geom_point() +
    geom_smooth() +
    facet_grid(condition ~ .) +
    theme_few()
```

Predicting utterance is harder than predicting selection. And we make better predictions over time (maybe not surprising, since human behavior stabilizes later on)

```{r}
modelOutput %>%
  gather(src,value,sameUtteranceAsParticipant,sameSelectionAsParticipant) %>%
  group_by(time, condition, src) %>%
  summarize(m = mean(value)) %>%
  ggplot(aes(x = time, y = m, color = src)) +
    geom_point(alpha = 0.25) +
    geom_smooth() +
    facet_grid(condition ~ .) +
    theme_few()
```

```{r}
modelOutput %>%
  gather(src,value,speakerPredictionLikelihood,listenerPredictionLikelihood) %>%
  group_by(time, condition, src) %>%
  summarize(m = mean(value)) %>%
  ggplot(aes(x = time, y = m)) +
    geom_point(alpha = 0.25) +
    geom_smooth() +
    facet_grid(src ~ condition, scale = 'free_y') +
    theme_few()
```